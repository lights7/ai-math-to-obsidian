/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __defNormalProp = (obj, key, value) => key in obj ? __defProp(obj, key, { enumerable: true, configurable: true, writable: true, value }) : obj[key] = value;
var __export = (target, all2) => {
  for (var name in all2)
    __defProp(target, name, { get: all2[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);
var __publicField = (obj, key, value) => {
  __defNormalProp(obj, typeof key !== "symbol" ? key + "" : key, value);
  return value;
};

// main.ts
var main_exports = {};
__export(main_exports, {
  default: () => Katex2MathjaxConverterPlugin
});
module.exports = __toCommonJS(main_exports);
var import_obsidian = require("obsidian");
var DEFAULT_SETTINGS = {
  enableDefaultPasteConversion: true
};
var Katex2MathjaxConverterPlugin = class extends import_obsidian.Plugin {
  constructor() {
    super(...arguments);
    __publicField(this, "settings");
  }
  async loadSettings() {
    this.settings = Object.assign({}, DEFAULT_SETTINGS, await this.loadData());
  }
  async saveSettings() {
    await this.saveData(this.settings);
  }
  async onload() {
    await this.loadSettings();
    this.addSettingTab(new MathJaxConverterSettingTab(this.app, this));
    this.registerEvent(
      this.app.workspace.on("editor-paste", async (evt, editor) => {
        var _a;
        const clipboardText = ((_a = evt.clipboardData) == null ? void 0 : _a.getData("text")) || "";
        const convertedText = this.settings.enableDefaultPasteConversion ? convertKatexToMathJax(clipboardText) : clipboardText;
        if (clipboardText) {
          evt.preventDefault();
          editor.replaceSelection(convertedText);
        }
      })
    );
    this.addCommand({
      id: "paste-katex-to-mathjax",
      name: "Paste with conversion",
      editorCallback: (editor) => {
        navigator.clipboard.readText().then((clipboardText) => {
          const convertedText = convertKatexToMathJax(clipboardText);
          editor.replaceSelection(convertedText);
        });
      }
    });
    this.addCommand({
      id: "convert-editor-text-from",
      name: "Convert current text file",
      editorCallback: (editor) => {
        const currentText = editor.getValue();
        const convertedText = convertKatexToMathJax(currentText);
        editor.setValue(convertedText);
      }
    });
    this.addCommand({
      id: "convert-all-files-from",
      name: "Convert all files",
      callback: async () => {
        const files = this.app.vault.getMarkdownFiles();
        for (const file of files) {
          const content = await this.app.vault.read(file);
          const convertedContent = convertKatexToMathJax(content);
          await this.app.vault.modify(file, convertedContent);
        }
        new import_obsidian.Notice("Text in the whole vault is converted from KaTeX to MathJax format!");
      }
    });
  }
};
function convertKatexToMathJax(input) {
  const terms = ["\\", "_", "^", "=", "+", "/", "\u2202", "\u221A"];
  if (input.includes("\\\\[") || input.includes("\\\\(")) {
    input = input.replace(/\\\\\((.*?)\\\\\)/g, (_match, p12) => {
      return `$${p12.trim()}$`;
    });
    input = input.replace(/\\\\\[(.*?)\\\\\]/gs, (_match, p12) => {
      return `
$$
${p12.trim()}
$$
`;
    });
    return input;
  } else if (input.includes("\\[") || input.includes("\\(")) {
    input = input.replace(/\\\((.*?)\\\)/g, (_match, p12) => {
      return `$${p12.trim()}$`;
    });
    input = input.replace(/\\\[(.*?)\\\]/gs, (_match, p12) => {
      return `
$$
${p12.trim()}
$$
`;
    });
    return input;
  } else if (input.includes("\\")) {
    m = 0;
    all = "";
    equ = 0;
    math = 0;
    string_math_space_ratio = 0.75;
    math_string_ratio = 0.1;
    const lines = input.split(/\r?\n/);
    for (p1 of lines) {
      len = p1.length;
      if (p1.includes("=")) {
        equ = 1;
      } else {
        equ = 0;
      }
      if (len == 1 && m == 0) {
        all = all + "$" + p1 + "$";
        m = 1;
      } else if (len < 12 && terms.some((term) => p1.includes(term))) {
        all = all + "$" + p1 + "$";
        m = 1;
      } else if (equ == 0 && len >= 12 && len <= 20 && terms.some((term) => p1.includes(term))) {
        all = all + "$" + p1 + "$";
        m = 1;
      } else if (equ == 1 && len >= 12 && terms.some((term) => p1.includes(term))) {
        all = all + "$$" + p1 + "$$";
        m = 2;
      } else {
        all = all + p1;
        m = 0;
      }
    }
  } else {
    m = 0;
    all = "";
    equ = 0;
    math = 0;
    string_math_space_ratio = 0.75;
    math_string_ratio = 0.1;
    const lines = input.split(/\r?\n/);
    for (p1 of lines) {
      len = p1.length;
      all_space_len = (p1.match(new RegExp(" ", "g")) || []).length;
      p1_no_space = p1.replaceAll(" + ", "").replaceAll(" - ", "").replaceAll(" = ", "");
      str_space_len = (p1_no_space.match(new RegExp(" ", "g")) || []).length;
      slash_num = (p1_no_space.match(/\\/g) || []).length;
      sub_num = (p1_no_space.match(/\_/g) || []).length;
      console.log(p1_no_space, str_space_len, all_space_len, slash_num, sub_num, len);
      if (str_space_len / all_space_len > string_math_space_ratio && slash_num + sub_num < 3) {
        math = 0;
      } else {
        math = 1;
      }
      if (p1.includes("=")) {
        equ = 1;
      } else {
        equ = 0;
      }
      if (len == 1 && m == 0) {
        all = all + "$" + p1 + "$";
        m = 1;
      } else if (len < 12 && terms.some((term) => p1.includes(term))) {
        all = all + "$" + p1 + "$";
        m = 1;
      } else if (equ == 0 && len >= 12 && len <= 20 && terms.some((term) => p1.includes(term))) {
        all = all + "$" + p1 + "$";
        m = 1;
      } else if (math == 0 && equ == 1 && len >= 12 && terms.some((term) => p1.includes(term))) {
        all = all + p1;
        m = 0;
      } else if (math == 1 && equ == 1 && len >= 12 && terms.some((term) => p1.includes(term))) {
        all = all + "$$" + p1 + "$$";
        m = 2;
      } else {
        all = all + p1 + "\n";
        m = 0;
      }
    }
    ;
    input = all;
    return input;
  }
}
var MathJaxConverterSettingTab = class extends import_obsidian.PluginSettingTab {
  /**
   * Constructs a new instance of the settings tab.
   * 
   * @param app - The application instance.
   * @param plugin - The plugin instance.
   */
  constructor(app, plugin) {
    super(app, plugin);
    __publicField(this, "plugin");
    this.plugin = plugin;
  }
  /**
   * Displays the settings tab.
   * 
   * This method creates the UI elements for the settings tab and sets up
   * event listeners for user interactions.
   */
  display() {
    const { containerEl } = this;
    containerEl.empty();
    new import_obsidian.Setting(containerEl).setName("Enable default paste conversion").setDesc("Automatically converts KaTeX to MathJax on paste action.").addToggle(
      (toggle) => toggle.setValue(this.plugin.settings.enableDefaultPasteConversion).onChange(async (value) => {
        this.plugin.settings.enableDefaultPasteConversion = value;
        await this.plugin.saveSettings();
      })
    );
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsibWFpbi50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHsgQXBwLCBOb3RpY2UsIFBsdWdpbiAsIFBsdWdpblNldHRpbmdUYWIsIFNldHRpbmcgfSBmcm9tIFwib2JzaWRpYW5cIjtcblxuaW50ZXJmYWNlIEthdGV4Mk1hdGhqYXhDb252ZXJ0ZXJTZXR0aW5ncyB7XG4gIGVuYWJsZURlZmF1bHRQYXN0ZUNvbnZlcnNpb246IGJvb2xlYW47XG59XG5cbmNvbnN0IERFRkFVTFRfU0VUVElOR1M6IEthdGV4Mk1hdGhqYXhDb252ZXJ0ZXJTZXR0aW5ncyA9IHtcbiAgZW5hYmxlRGVmYXVsdFBhc3RlQ29udmVyc2lvbjogdHJ1ZSxcbn07XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEthdGV4Mk1hdGhqYXhDb252ZXJ0ZXJQbHVnaW4gZXh0ZW5kcyBQbHVnaW4ge1xuICBzZXR0aW5nczogS2F0ZXgyTWF0aGpheENvbnZlcnRlclNldHRpbmdzO1xuXG4gIGFzeW5jIGxvYWRTZXR0aW5ncygpIHtcbiAgICB0aGlzLnNldHRpbmdzID0gT2JqZWN0LmFzc2lnbih7fSwgREVGQVVMVF9TRVRUSU5HUywgYXdhaXQgdGhpcy5sb2FkRGF0YSgpKTtcbiAgfVxuXG4gIGFzeW5jIHNhdmVTZXR0aW5ncygpIHtcbiAgICBhd2FpdCB0aGlzLnNhdmVEYXRhKHRoaXMuc2V0dGluZ3MpO1xuICB9XG5cbiAgYXN5bmMgb25sb2FkKCkge1xuICAgIC8vIExvYWQgcGx1Z2luIHNldHRpbmdzXG4gICAgYXdhaXQgdGhpcy5sb2FkU2V0dGluZ3MoKTtcblxuICAgIC8vIEFkZCBzZXR0aW5ncyB0YWJcbiAgICB0aGlzLmFkZFNldHRpbmdUYWIobmV3IE1hdGhKYXhDb252ZXJ0ZXJTZXR0aW5nVGFiKHRoaXMuYXBwLCB0aGlzKSk7XG5cbiAgICAvLyBFdmVudCBmb3IgZGVmYXVsdCBwYXN0ZSBiYXNlZCBvbiB0aGUgc2V0dGluZ3MgJ2VuYWJsZURlZmF1bHRQYXN0ZUNvbnZlcnNpb24nIHZhbHVlXG4gICAgdGhpcy5yZWdpc3RlckV2ZW50KFxuICAgICAgdGhpcy5hcHAud29ya3NwYWNlLm9uKFwiZWRpdG9yLXBhc3RlXCIsIGFzeW5jIChldnQsIGVkaXRvcikgPT4ge1xuICAgICAgICBjb25zdCBjbGlwYm9hcmRUZXh0ID0gZXZ0LmNsaXBib2FyZERhdGE/LmdldERhdGEoXCJ0ZXh0XCIpIHx8IFwiXCJcbiAgICAgICAgY29uc3QgY29udmVydGVkVGV4dCA9IHRoaXMuc2V0dGluZ3MuZW5hYmxlRGVmYXVsdFBhc3RlQ29udmVyc2lvblxuICAgICAgICAgID8gY29udmVydEthdGV4VG9NYXRoSmF4KGNsaXBib2FyZFRleHQpXG4gICAgICAgICAgOiBjbGlwYm9hcmRUZXh0O1xuXG4gICAgICAgICAgaWYgKGNsaXBib2FyZFRleHQpIHtcbiAgICAgICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgZWRpdG9yLnJlcGxhY2VTZWxlY3Rpb24oY29udmVydGVkVGV4dCk7XG4gICAgICAgICAgfVxuICAgICAgICBcbiAgICAgIH0pXG4gICAgKTtcblxuICAgIC8vIENvbW1hbmQ6IFBhc3RlIHdpdGggY29udmVyc2lvblxuICAgIHRoaXMuYWRkQ29tbWFuZCh7XG4gICAgICBpZDogXCJwYXN0ZS1rYXRleC10by1tYXRoamF4XCIsXG4gICAgICBuYW1lOiBcIlBhc3RlIHdpdGggY29udmVyc2lvblwiLFxuICAgICAgZWRpdG9yQ2FsbGJhY2s6IChlZGl0b3IpID0+IHtcbiAgICAgICAgbmF2aWdhdG9yLmNsaXBib2FyZC5yZWFkVGV4dCgpLnRoZW4oKGNsaXBib2FyZFRleHQpID0+IHtcbiAgICAgICAgICBjb25zdCBjb252ZXJ0ZWRUZXh0ID0gY29udmVydEthdGV4VG9NYXRoSmF4KGNsaXBib2FyZFRleHQpXG4gICAgICAgICAgZWRpdG9yLnJlcGxhY2VTZWxlY3Rpb24oY29udmVydGVkVGV4dCk7XG4gICAgICAgIH0pO1xuICAgICAgfSxcbiAgICB9KTtcblxuICAgIC8vIENvbW1hbmQ6IENvbnZlcnQgZXhpc3RpbmcgdGV4dCBpbiB0aGUgZWRpdG9yIGZyb20gS2FUZVggdG8gTWF0aEpheFxuICAgIHRoaXMuYWRkQ29tbWFuZCh7XG4gICAgICBpZDogXCJjb252ZXJ0LWVkaXRvci10ZXh0LWZyb21cIixcbiAgICAgIG5hbWU6IFwiQ29udmVydCBjdXJyZW50IHRleHQgZmlsZVwiLFxuICAgICAgZWRpdG9yQ2FsbGJhY2s6IChlZGl0b3IpID0+IHtcbiAgICAgICAgY29uc3QgY3VycmVudFRleHQgPSBlZGl0b3IuZ2V0VmFsdWUoKTtcbiAgICAgICAgY29uc3QgY29udmVydGVkVGV4dCA9IGNvbnZlcnRLYXRleFRvTWF0aEpheChjdXJyZW50VGV4dCk7XG4gICAgICAgIGVkaXRvci5zZXRWYWx1ZShjb252ZXJ0ZWRUZXh0KTtcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICAvLyBDb21tYW5kOiBDb252ZXJ0IGFsbCBmaWxlcyBpbiB0aGUgdmF1bHQgZnJvbSBLYVRlWCB0byBNYXRoSmF4XG4gICAgdGhpcy5hZGRDb21tYW5kKHtcbiAgICAgIGlkOiBcImNvbnZlcnQtYWxsLWZpbGVzLWZyb21cIixcbiAgICAgIG5hbWU6IFwiQ29udmVydCBhbGwgZmlsZXNcIixcbiAgICAgIGNhbGxiYWNrOiBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IGZpbGVzID0gdGhpcy5hcHAudmF1bHQuZ2V0TWFya2Rvd25GaWxlcygpO1xuICAgICAgICBmb3IgKGNvbnN0IGZpbGUgb2YgZmlsZXMpIHtcbiAgICAgICAgICBjb25zdCBjb250ZW50ID0gYXdhaXQgdGhpcy5hcHAudmF1bHQucmVhZChmaWxlKTtcbiAgICAgICAgICBjb25zdCBjb252ZXJ0ZWRDb250ZW50ID0gY29udmVydEthdGV4VG9NYXRoSmF4KGNvbnRlbnQpO1xuICAgICAgICAgIGF3YWl0IHRoaXMuYXBwLnZhdWx0Lm1vZGlmeShmaWxlLCBjb252ZXJ0ZWRDb250ZW50KTtcbiAgICAgICAgfVxuICAgICAgICBuZXcgTm90aWNlKFwiVGV4dCBpbiB0aGUgd2hvbGUgdmF1bHQgaXMgY29udmVydGVkIGZyb20gS2FUZVggdG8gTWF0aEpheCBmb3JtYXQhXCIpO1xuICAgICAgfSxcbiAgICB9KTtcbiAgfVxufVxuXG4vKipcbiAqIENvbnZlcnRzIEthVGVYIGZvcm1hdHRlZCBzdHJpbmdzIHRvIE1hdGhKYXggZm9ybWF0dGVkIHN0cmluZ3MuXG4gKiBcbiAqIFRoaXMgZnVuY3Rpb24gcGVyZm9ybXMgdGhlIGZvbGxvd2luZyBjb252ZXJzaW9uczpcbiAqIDEuIFJlcGxhY2VzIFxcKFxcdGV4dHtzYW1wbGV9XFwpIHdpdGggJFxcdGV4dHtzYW1wbGV9JC5cbiAqIDIuIFJlcGxhY2VzIFxcW1xcdGV4dHtzYW1wbGV9XFxdIHdpdGggJCRcXHRleHR7c2FtcGxlfSQkLlxuICogXG4gKiBAcGFyYW0gaW5wdXQgLSBUaGUgaW5wdXQgc3RyaW5nIGNvbnRhaW5pbmcgS2FUZVggZm9ybWF0dGVkIHRleHQuXG4gKiBAcmV0dXJucyBUaGUgY29udmVydGVkIHN0cmluZyB3aXRoIE1hdGhKYXggZm9ybWF0dGVkIHRleHQuXG4gKi9cbmZ1bmN0aW9uIGNvbnZlcnRLYXRleFRvTWF0aEpheChpbnB1dDogc3RyaW5nKTogc3RyaW5nIHtcbmNvbnN0IHRlcm1zID0gW1wiXFxcXFwiLCBcIl9cIiwgXCJeXCIsIFwiPVwiLCBcIitcIiwgXCIvXCIsXCJcXFx1MjIwMlwiLFwiXFxcdTIyMUFcIl07XG5pZiAoaW5wdXQuaW5jbHVkZXMoXCJcXFxcXFxcXFtcIikgfHwgaW5wdXQuaW5jbHVkZXMoXCJcXFxcXFxcXChcIikpIHsgLy8gZnJvbSBMaW5lciBcbiAgaW5wdXQgPSBpbnB1dC5yZXBsYWNlKC9cXFxcXFxcXFxcKCguKj8pXFxcXFxcXFxcXCkvZywgKF9tYXRjaCwgcDEpID0+IHtcbiAgICByZXR1cm4gYCQke3AxLnRyaW0oKX0kYDtcbiAgfSk7XG4gIC8vIFJlcGxhY2UgXFxbXFx0ZXh0e3NhbXBsZX1cXF0gd2l0aCAkJFxcdGV4dHtzYW1wbGV9JCRcbiAgaW5wdXQgPSBpbnB1dC5yZXBsYWNlKC9cXFxcXFxcXFxcWyguKj8pXFxcXFxcXFxcXF0vZ3MsIChfbWF0Y2gsIHAxKSA9PiB7XG4gICAgcmV0dXJuIGBcXG4kJFxcbiR7cDEudHJpbSgpfVxcbiQkXFxuYDtcbiAgfSk7XG4gIHJldHVybiBpbnB1dDsgLy8gcmV0dXJuIENoYXRHUFRcblxufWVsc2UgaWYgKGlucHV0LmluY2x1ZGVzKFwiXFxcXFxcW1wiKSB8fCBpbnB1dC5pbmNsdWRlcyhcIlxcXFxcXChcIikpIHsgLy8gZnJvbSBDaGF0R1BUXG4gIGlucHV0ID0gaW5wdXQucmVwbGFjZSgvXFxcXFxcKCguKj8pXFxcXFxcKS9nLCAoX21hdGNoLCBwMSkgPT4ge1xuICAgIHJldHVybiBgJCR7cDEudHJpbSgpfSRgO1xuICB9KTtcbiAgLy8gUmVwbGFjZSBcXFtcXHRleHR7c2FtcGxlfVxcXSB3aXRoICQkXFx0ZXh0e3NhbXBsZX0kJFxuICBpbnB1dCA9IGlucHV0LnJlcGxhY2UoL1xcXFxcXFsoLio/KVxcXFxcXF0vZ3MsIChfbWF0Y2gsIHAxKSA9PiB7XG4gICAgcmV0dXJuIGBcXG4kJFxcbiR7cDEudHJpbSgpfVxcbiQkXFxuYDtcbiAgfSk7XG4gIHJldHVybiBpbnB1dDsgLy8gcmV0dXJuIENoYXRHUFRcblxufWVsc2UgaWYoIGlucHV0LmluY2x1ZGVzKFwiXFxcXFwiKSkgeyAgICAvLyBpbnB1dCBmcm9tIEdyb2tcbiAgbT0wOyAvLyBwcmV2aW91cyBsaW5lIGlzIGVxdSBpZiAxLCBubyBtYXRoIGVxdSBpZiAwXG4gIGFsbD1cIlwiXG4gIGVxdSA9IDA7XG4gIG1hdGggPSAwO1xuICBzdHJpbmdfbWF0aF9zcGFjZV9yYXRpbyA9IDAuNzU7XG4gIG1hdGhfc3RyaW5nX3JhdGlvID0gMC4xO1xuICBjb25zdCBsaW5lcz1pbnB1dC5zcGxpdCgvXFxyP1xcbi8pO1xuICBmb3IgKHAxIG9mIGxpbmVzKSB7XG4gICAgbGVuPXAxLmxlbmd0aDtcbiAgICAvL2NvbnNvbGUubG9nKFwicmVtb3ZlZCBzcGFjZVwiLHAxLnJlcGxhY2UoL1xcICtcXCB8XFwgLVxcIHxcXCA9XFwgL2csXCJcIikpXG4vKiAgICBpZihzdHJfc3BhY2VfbGVuL2FsbF9zcGFjZV9sZW4+c3RyaW5nX21hdGhfc3BhY2VfcmF0aW8gJiYgKHNsYXNoX251bStzdWJfbnVtKTwzKXtcbiAgICAgIG1hdGg9MDtcbiAgICB9ZWxzZXtcbiAgICAgIG1hdGg9MTtcbiAgICB9XG4qL1xuICAgIGlmKHAxLmluY2x1ZGVzKFwiPVwiKSl7XG4gICAgICAgZXF1ID0gMTtcbiAgICB9ZWxzZXtcbiAgICAgICBlcXUgPSAwO1xuICAgIH1cbiAgICBpZiAobGVuID09IDEgJiYgbT09MCkgeyAvLyB0aGlzIGxpbmUgaXMgc2hvcnQgZXF1LCBubyBlcXUgaW4gcHJldmlvdXNcbiAgICAgIGFsbD1hbGwrXCJcXCRcIitwMStcIlxcJFwiO1xuICAgICAgbT0xO1xuICAgIH0gZWxzZSBpZiAobGVuIDwgMTIgJiYgdGVybXMuc29tZSgodGVybSkgPT4gcDEuaW5jbHVkZXModGVybSkpKSB7XG4gICAgICBhbGw9YWxsK1wiXFwkXCIrcDErXCJcXCRcIjtcbiAgICAgIG09MTtcbiAgICB9IGVsc2UgaWYgKGVxdSA9PSAwICYmIGxlbiA+PSAxMiAmJiBsZW48PTIwICYmIHRlcm1zLnNvbWUoKHRlcm0pID0+IHAxLmluY2x1ZGVzKHRlcm0pKSkge1xuICAgICAgYWxsPWFsbCtcIlxcJFwiK3AxK1wiXFwkXCI7XG4gICAgICBtPTE7XG4gICAgfSBlbHNlIGlmIChlcXUgPT0gMSAmJiBsZW4gPj0gMTIgJiYgdGVybXMuc29tZSgodGVybSkgPT4gcDEuaW5jbHVkZXModGVybSkpKSB7XG4gICAgICBhbGw9YWxsK1wiXFwkXFwkXCIrcDErXCJcXCRcXCRcIjtcbiAgICAgIG09MjtcbiAgICB9IGVsc2UgeyAvLyB0aGlzIGxpbmUgaXMgbm90IGVxdWF0aW9uXG4gICAgICAgIGFsbD1hbGwrcDE7XG4gICAgICBtPTBcbiAgICB9XG4gIH1cblxufWVsc2V7IC8vIGlucHV0IGZyb20gTGxhbWEgYW5kIENsYXVkZVxuICBtPTA7IC8vIHByZXZpb3VzIGxpbmUgaXMgZXF1IGlmIDEsIG5vIG1hdGggZXF1IGlmIDBcbiAgYWxsPVwiXCJcbiAgZXF1ID0gMDtcbiAgbWF0aCA9IDA7XG4gIHN0cmluZ19tYXRoX3NwYWNlX3JhdGlvID0gMC43NTtcbiAgbWF0aF9zdHJpbmdfcmF0aW8gPSAwLjE7XG4gIGNvbnN0IGxpbmVzPWlucHV0LnNwbGl0KC9cXHI/XFxuLyk7XG4gIGZvciAocDEgb2YgbGluZXMpIHtcbiAgICBsZW49cDEubGVuZ3RoO1xuICAgIC8vY29uc29sZS5sb2coXCJyZW1vdmVkIHNwYWNlXCIscDEucmVwbGFjZSgvXFwgK1xcIHxcXCAtXFwgfFxcID1cXCAvZyxcIlwiKSlcbiAgICBhbGxfc3BhY2VfbGVuPShwMS5tYXRjaChuZXcgUmVnRXhwKFwiIFwiLCBcImdcIikpIHx8IFtdKS5sZW5ndGg7XG4gICAgcDFfbm9fc3BhY2U9cDEucmVwbGFjZUFsbChcIiArIFwiLCAnJykucmVwbGFjZUFsbChcIiAtIFwiLCcnKS5yZXBsYWNlQWxsKFwiID0gXCIsJycpOyAvLyByZW1vdmUgY2VydGFpbiBzcGFjZSAgYW5kICstPVxuICAgIHN0cl9zcGFjZV9sZW49KHAxX25vX3NwYWNlLm1hdGNoKG5ldyBSZWdFeHAoXCIgXCIsIFwiZ1wiKSkgfHwgW10pLmxlbmd0aDtcbiAgICBzbGFzaF9udW09KHAxX25vX3NwYWNlLm1hdGNoKC9cXFxcL2cpIHx8IFtdKS5sZW5ndGg7XG4gICAgc3ViX251bT0ocDFfbm9fc3BhY2UubWF0Y2goL1xcXy9nKSB8fCBbXSkubGVuZ3RoO1xuICAgIGNvbnNvbGUubG9nKHAxX25vX3NwYWNlLHN0cl9zcGFjZV9sZW4sYWxsX3NwYWNlX2xlbixzbGFzaF9udW0sc3ViX251bSxsZW4pXG4gICAgaWYoc3RyX3NwYWNlX2xlbi9hbGxfc3BhY2VfbGVuPnN0cmluZ19tYXRoX3NwYWNlX3JhdGlvICYmIChzbGFzaF9udW0rc3ViX251bSk8Myl7XG4gICAgICBtYXRoPTA7XG4gICAgfWVsc2V7XG4gICAgICBtYXRoPTE7XG4gICAgfVxuXG4gICAgaWYocDEuaW5jbHVkZXMoXCI9XCIpKXtcbiAgICAgICBlcXUgPSAxO1xuICAgIH1lbHNle1xuICAgICAgIGVxdSA9IDA7XG4gICAgfVxuXG4gICAgaWYgKGxlbiA9PSAxICYmIG09PTApIHsgLy8gdGhpcyBsaW5lIGlzIHNob3J0IGVxdSwgbm8gZXF1IGluIHByZXZpb3VzXG4gICAgICBhbGw9YWxsK1wiXFwkXCIrcDErXCJcXCRcIjtcbiAgICAgIG09MTtcbiAgICB9IGVsc2UgaWYgKGxlbiA8IDEyICYmIHRlcm1zLnNvbWUoKHRlcm0pID0+IHAxLmluY2x1ZGVzKHRlcm0pKSkge1xuICAgICAgYWxsPWFsbCtcIlxcJFwiK3AxK1wiXFwkXCI7XG4gICAgICBtPTE7XG4gICAgfSBlbHNlIGlmIChlcXUgPT0gMCAmJiBsZW4gPj0gMTIgJiYgbGVuPD0yMCAmJiB0ZXJtcy5zb21lKCh0ZXJtKSA9PiBwMS5pbmNsdWRlcyh0ZXJtKSkpIHtcbiAgICAgIGFsbD1hbGwrXCJcXCRcIitwMStcIlxcJFwiO1xuICAgICAgbT0xO1xuICAgIH0gZWxzZSBpZiAobWF0aCA9PSAwICYmIGVxdSA9PSAxICYmIGxlbiA+PSAxMiAmJiB0ZXJtcy5zb21lKCh0ZXJtKSA9PiBwMS5pbmNsdWRlcyh0ZXJtKSkpIHtcbiAgICAgIGFsbD1hbGwrcDE7XG4gICAgICBtPTA7XG4gICAgfSBlbHNlIGlmIChtYXRoID09IDEgJiYgZXF1ID09IDEgJiYgbGVuID49IDEyICYmIHRlcm1zLnNvbWUoKHRlcm0pID0+IHAxLmluY2x1ZGVzKHRlcm0pKSkge1xuICAgICAgYWxsPWFsbCtcIlxcJFxcJFwiK3AxK1wiXFwkXFwkXCI7XG4gICAgICBtPTI7XG4gICAgfSBlbHNlIHsgLy8gdGhpcyBsaW5lIGlzIG5vdCBlcXVhdGlvblxuICAgICAgICBhbGw9YWxsK3AxKydcXG4nO1xuICAgICAgbT0wXG4gICAgfVxuICB9O1xuICBpbnB1dD1hbGw7XG4gIHJldHVybiBpbnB1dDsgLy8gcmV0dXJuIEdyb2tcbn1cbn1cblxuLyoqXG4gKiBTZXR0aW5ncyB0YWIgZm9yIHRoZSBNYXRoSmF4IENvbnZlcnRlciBQbHVnaW4uXG4gKiBcbiAqIFRoaXMgY2xhc3MgY3JlYXRlcyBhIHNldHRpbmdzIHRhYiBpbiB0aGUgYXBwbGljYXRpb24gd2hlcmUgdXNlcnMgY2FuXG4gKiBjb25maWd1cmUgdGhlIHBsdWdpbiBzZXR0aW5ncy5cbiAqL1xuY2xhc3MgTWF0aEpheENvbnZlcnRlclNldHRpbmdUYWIgZXh0ZW5kcyBQbHVnaW5TZXR0aW5nVGFiIHtcbiAgcGx1Z2luOiBLYXRleDJNYXRoamF4Q29udmVydGVyUGx1Z2luO1xuXG4gIC8qKlxuICAgKiBDb25zdHJ1Y3RzIGEgbmV3IGluc3RhbmNlIG9mIHRoZSBzZXR0aW5ncyB0YWIuXG4gICAqIFxuICAgKiBAcGFyYW0gYXBwIC0gVGhlIGFwcGxpY2F0aW9uIGluc3RhbmNlLlxuICAgKiBAcGFyYW0gcGx1Z2luIC0gVGhlIHBsdWdpbiBpbnN0YW5jZS5cbiAgICovXG4gIGNvbnN0cnVjdG9yKGFwcDogQXBwLCBwbHVnaW46IEthdGV4Mk1hdGhqYXhDb252ZXJ0ZXJQbHVnaW4pIHtcbiAgICBzdXBlcihhcHAsIHBsdWdpbik7XG4gICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47XG4gIH1cblxuICAvKipcbiAgICogRGlzcGxheXMgdGhlIHNldHRpbmdzIHRhYi5cbiAgICogXG4gICAqIFRoaXMgbWV0aG9kIGNyZWF0ZXMgdGhlIFVJIGVsZW1lbnRzIGZvciB0aGUgc2V0dGluZ3MgdGFiIGFuZCBzZXRzIHVwXG4gICAqIGV2ZW50IGxpc3RlbmVycyBmb3IgdXNlciBpbnRlcmFjdGlvbnMuXG4gICAqL1xuICBkaXNwbGF5KCk6IHZvaWQge1xuICAgIGNvbnN0IHsgY29udGFpbmVyRWwgfSA9IHRoaXM7XG5cbiAgICBjb250YWluZXJFbC5lbXB0eSgpO1xuXG4gICAgLy8gVG9nZ2xlIGZvciBlbmFibGluZy9kaXNhYmxpbmcgZGVmYXVsdCBwYXN0ZSBjb252ZXJzaW9uXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAuc2V0TmFtZShcIkVuYWJsZSBkZWZhdWx0IHBhc3RlIGNvbnZlcnNpb25cIilcbiAgICAgIC5zZXREZXNjKFwiQXV0b21hdGljYWxseSBjb252ZXJ0cyBLYVRlWCB0byBNYXRoSmF4IG9uIHBhc3RlIGFjdGlvbi5cIilcbiAgICAgIC5hZGRUb2dnbGUoKHRvZ2dsZSkgPT5cbiAgICAgICAgdG9nZ2xlXG4gICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmVuYWJsZURlZmF1bHRQYXN0ZUNvbnZlcnNpb24pXG4gICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuZW5hYmxlRGVmYXVsdFBhc3RlQ29udmVyc2lvbiA9IHZhbHVlO1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgfSlcbiAgICAgICk7XG4gIH1cbn1cbiJdLAogICJtYXBwaW5ncyI6ICI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLHNCQUFnRTtBQU1oRSxJQUFNLG1CQUFtRDtBQUFBLEVBQ3ZELDhCQUE4QjtBQUNoQztBQUVBLElBQXFCLCtCQUFyQixjQUEwRCx1QkFBTztBQUFBLEVBQWpFO0FBQUE7QUFDRTtBQUFBO0FBQUEsRUFFQSxNQUFNLGVBQWU7QUFDbkIsU0FBSyxXQUFXLE9BQU8sT0FBTyxDQUFDLEdBQUcsa0JBQWtCLE1BQU0sS0FBSyxTQUFTLENBQUM7QUFBQSxFQUMzRTtBQUFBLEVBRUEsTUFBTSxlQUFlO0FBQ25CLFVBQU0sS0FBSyxTQUFTLEtBQUssUUFBUTtBQUFBLEVBQ25DO0FBQUEsRUFFQSxNQUFNLFNBQVM7QUFFYixVQUFNLEtBQUssYUFBYTtBQUd4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
